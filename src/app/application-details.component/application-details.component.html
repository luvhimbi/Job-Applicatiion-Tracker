<div class="container py-4">
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border spinner-border-sm text-primary"></div>
  </div>

  <div *ngIf="!loading && app" class="row justify-content-center">
    <div class="col-lg-7">

      <div class="d-flex justify-content-between align-items-center mb-3">
        <a routerLink="/" class="btn btn-link text-decoration-none p-0 text-dark fw-semibold x-small">
          <i class="bi bi-arrow-left me-1"></i> Back to Pipeline
        </a>
        <a [routerLink]="['/application/edit', app.id]" class="btn btn-outline-dark rounded-pill px-3 py-1 x-small shadow-sm">
          <i class="bi bi-pencil-square me-2"></i>Edit Details
        </a>
      </div>

      <div class="card border-0 shadow-sm overflow-hidden mb-3">
        <div class="card-header bg-white p-3 border-0 border-bottom">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h3 class="fw-bold mb-0 text-dark" style="font-size: 1.25rem; letter-spacing: -0.02em;">{{ app.companyName }}</h3>
              <p class="text-secondary fw-medium mb-2" style="font-size: 0.9rem;">{{ app.jobTitle }}</p>

              <div class="d-flex flex-wrap gap-3 text-muted" style="font-size: 0.75rem;">
                <span><i class="bi bi-geo-alt me-1"></i>{{ app.location || 'Remote' }}</span>
                <span><i class="bi bi-calendar3 me-1"></i>Applied: {{ formatDate(app.applicationDate) | date:'mediumDate' }}</span>
              </div>
            </div>
            <span class="badge rounded-pill px-3 py-1 text-uppercase status-badge" [ngClass]="'bg-' + app.status.toLowerCase()">
              {{ app.status }}
            </span>
          </div>
        </div>

        <div class="card-body p-3">
          <label class="x-small text-uppercase fw-bold text-muted mb-2 d-block" style="letter-spacing: 0.5px;">Notes & Interview Prep</label>
          <div class="bg-light p-3 rounded-3 border-start border-3 border-primary">
            <p class="text-dark mb-0" style="white-space: pre-line; line-height: 1.5; font-size: 0.85rem;">
              {{ app.notes || 'No notes recorded for this application.' }}
            </p>
          </div>
        </div>
      </div>

      <div class="card border-0 shadow-sm">
        <div class="card-body p-3">
          <h6 class="fw-bold mb-3" style="font-size: 0.9rem;">Hiring Contacts</h6>

          <div class="row g-2">
            <div class="col-md-6" *ngFor="let contact of app.contacts">
              <div class="p-2 border rounded-3 bg-white h-100">
                <div class="fw-bold text-dark" style="font-size: 0.8rem;">{{ contact.name || 'Unnamed Contact' }}</div>
                <div class="text-primary fw-medium mb-1" style="font-size: 0.7rem;">{{ contact.role || 'No Role Specified' }}</div>
                <div class="text-muted" style="font-size: 0.7rem;">
                  <i class="bi bi-envelope-at me-1"></i> {{ contact.email || 'No Email/Link' }}
                </div>
              </div>
            </div>

            <div *ngIf="!app.contacts?.length" class="text-center py-3 bg-light rounded-3 w-100">
              <i class="bi bi-people text-muted" style="font-size: 1.2rem;"></i>
              <p class="text-muted x-small mt-1 mb-0">No contact persons listed yet.</p>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
