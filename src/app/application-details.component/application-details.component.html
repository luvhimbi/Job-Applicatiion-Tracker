<app-navbar></app-navbar>

<div class="container py-5">
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary"></div>
  </div>

  <div *ngIf="!loading && app" class="row justify-content-center">
    <div class="col-lg-8">

      <div class="d-flex justify-content-between align-items-center mb-4">
        <a routerLink="/" class="btn btn-link text-decoration-none p-0 text-dark fw-semibold">
          <i class="bi bi-arrow-left me-1"></i> Back to Pipeline
        </a>
        <a [routerLink]="['/application/edit', app.id]" class="btn btn-outline-dark rounded-pill px-4 shadow-sm">
          <i class="bi bi-pencil-square me-2"></i>Edit Details
        </a>
      </div>

      <div class="card border-0 shadow-sm overflow-hidden mb-4">
        <div class="card-header bg-white p-4 border-0 border-bottom">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h1 class="fw-bold mb-1 text-dark">{{ app.companyName }}</h1>
              <h4 class="text-secondary fw-normal mb-3">{{ app.jobTitle }}</h4>
              <div class="d-flex gap-3 text-muted small">
                <span><i class="bi bi-geo-alt me-1"></i>{{ app.location || 'Remote' }}</span>
                <span><i class="bi bi-calendar3 me-1"></i>Applied: {{ formatDate(app.applicationDate) | date:'mediumDate' }}</span>
              </div>
            </div>
            <span class="badge rounded-pill px-4 py-2 text-uppercase" [ngClass]="'bg-' + app.status.toLowerCase()">
              {{ app.status }}
            </span>
          </div>
        </div>

        <div class="card-body p-4">
          <label class="small text-uppercase fw-bold text-muted mb-3 d-block">Notes & Interview Prep</label>
          <div class="bg-light p-4 rounded-3 border-start border-4 border-primary">
            <p class="text-dark mb-0" style="white-space: pre-line; line-height: 1.6;">
              {{ app.notes || 'No notes recorded for this application.' }}
            </p>
          </div>
        </div>
      </div>

      <div class="card border-0 shadow-sm">
        <div class="card-body p-4">
          <h5 class="fw-bold mb-4">Hiring Contacts</h5>

          <div class="row g-3">
            <div class="col-md-6" *ngFor="let contact of app.contacts">
              <div class="p-3 border rounded-3 bg-white h-100">
                <div class="fw-bold text-dark">{{ contact.name || 'Unnamed Contact' }}</div>
                <div class="text-primary small mb-2">{{ contact.role || 'No Role Specified' }}</div>
                <div class="text-muted small">
                  <i class="bi bi-envelope-at me-1"></i> {{ contact.email || 'No Email/Link' }}
                </div>
              </div>
            </div>

            <div *ngIf="!app.contacts?.length" class="text-center py-4 bg-light rounded-3 w-100">
              <i class="bi bi-people text-muted fs-2"></i>
              <p class="text-muted small mt-2 mb-0">No contact persons listed yet.</p>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
